{% extends 'core/base.html' %}
{% load static %}

{% block title %}Générer un badge - {{ adherent.full_name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/badge-templates.css' %}">
<style>
    .template-preview {
        border: 2px solid #dee2e6;
        border-radius: 10px;
        padding: 20px;
        margin: 15px 0;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .template-preview:hover {
        border-color: #007bff;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
    }
    
    .template-preview.selected {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    
    .template-preview h5 {
        margin-bottom: 15px;
        color: #495057;
    }
    
    .template-preview .badge-demo {
        max-width: 300px;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-id-card me-2"></i>
                        Générer un badge pour {{ adherent.full_name }}
                    </h4>
                </div>
                <div class="card-body">
                    <!-- Informations de l'adhérent -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>Informations de l'adhérent</h5>
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Nom complet:</strong></td>
                                    <td>{{ adherent.full_name }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Identifiant:</strong></td>
                                    <td>{{ adherent.identifiant }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Organisation:</strong></td>
                                    <td>{{ adherent.organisation.name }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Activité:</strong></td>
                                    <td>{{ adherent.activity_name }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Validité:</strong></td>
                                    <td>{{ adherent.badge_validity|date:"d/m/Y" }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            {% if adherent.profile_picture %}
                            <div class="text-center">
                                <h5>Photo de profil</h5>
                                <img src="{{ adherent.profile_picture.url }}" 
                                     alt="Photo de profil" 
                                     class="img-fluid rounded" 
                                     style="max-width: 150px;">
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Choix du template -->
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-4">
                            <h5>Choisissez un design de badge</h5>
                            <p class="text-muted">Sélectionnez le template qui correspond le mieux à vos besoins.</p>
                            
                            <div class="row">
                                {% for template in form.fields.template.queryset %}
                                <div class="col-md-4 mb-3">
                                    <div class="template-preview" onclick="selectTemplate({{ template.id }})">
                                        <h5>{{ template.name }}</h5>
                                        <p class="text-muted small">{{ template.description }}</p>
                                        
                                        <!-- Aperçu du template -->
                                        <div class="badge-demo">
                                            <div class="badge-template-{{ template.template_type }}">
                                                <div class="badge-header">
                                                    BADGE D'ADHÉRENT
                                                </div>
                                                <div class="badge-content">
                                                    <div class="badge-field">
                                                        <strong>Nom:</strong>
                                                        <span>{{ adherent.first_name }} {{ adherent.last_name }}</span>
                                                    </div>
                                                    <div class="badge-field">
                                                        <strong>Activité:</strong>
                                                        <span>{{ adherent.activity_name }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-check mt-3">
                                            <input class="form-check-input" type="radio" 
                                                   name="template" value="{{ template.id }}" 
                                                   id="template_{{ template.id }}">
                                            <label class="form-check-label" for="template_{{ template.id }}">
                                                Choisir ce template
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{% url 'core:adherent_detail' adherent.id %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Retour
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-magic me-2"></i>Générer le badge
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function selectTemplate(templateId) {
    // Désélectionner tous les templates
    document.querySelectorAll('.template-preview').forEach(preview => {
        preview.classList.remove('selected');
    });
    
    // Sélectionner le template cliqué
    const selectedPreview = event.currentTarget;
    selectedPreview.classList.add('selected');
    
    // Cocher le radio button correspondant
    const radio = document.getElementById('template_' + templateId);
    radio.checked = true;
}

// Sélectionner le premier template par défaut
document.addEventListener('DOMContentLoaded', function() {
    const firstTemplate = document.querySelector('.template-preview');
    if (firstTemplate) {
        firstTemplate.classList.add('selected');
        const firstRadio = firstTemplate.querySelector('input[type="radio"]');
        if (firstRadio) {
            firstRadio.checked = true;
        }
    }
});
</script>
{% endblock %} 